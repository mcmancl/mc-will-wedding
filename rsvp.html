<section id="rsvp">
  <h2>RSVP</h2>
  <p>We canâ€™t wait to celebrate with you! Please enter your name below to RSVP for your party.</p>

  <div class="rsvp-container">
    <input type="text" id="guestNameInput" placeholder="Enter your name" />
    <button id="rsvpButton">RSVP</button>
    <p id="rsvpMessage"></p>
  </div>

  <style>
    .rsvp-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
      max-width: 400px;
      margin: 2rem auto;
    }

    .rsvp-container input {
      width: 100%;
      padding: 0.8rem 1rem;
      font-family: 'Montserrat', sans-serif;
      font-size: 1rem;
      border: 2px solid var(--mulberry);
      border-radius: 8px;
      outline: none;
      transition: border-color 0.3s;
    }

    .rsvp-container input:focus { border-color: var(--green); }

    .rsvp-container button {
      padding: 0.8rem 1.2rem;
      font-family: 'Cormorant Garamond', serif;
      font-size: 1rem;
      color: white;
      background-color: var(--mulberry);
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .rsvp-container button:hover { background-color: var(--green); }

    #rsvpMessage { font-family: 'Montserrat', sans-serif; font-size: 0.95rem; color: var(--mulberry); }
    #rsvpMessage.error { color: red; }
  </style>

  <script>
    async function loadGuestList() {
      const response = await fetch('data/guestlist.csv');
      const text = await response.text();

      const rows = text.trim().split('\n');
      const header = rows.shift(); // remove header row

      const partyMap = {}; // party_key => form_url
      const guestMap = {}; // guest_name_lower => party_key

      rows.forEach(row => {
        const cols = row.split(',').map(c => c.trim());
        if (cols.length < 3) return;
        const [partyKey, guestName, formUrl] = cols;
        partyMap[partyKey] = formUrl; // every party key points to its form
        guestMap[guestName.toLowerCase()] = partyKey; // map guest to party
      });

      return { guestMap, partyMap };
    }

    document.addEventListener('DOMContentLoaded', async () => {
      const { guestMap, partyMap } = await loadGuestList();
      const input = document.getElementById('guestNameInput');
      const button = document.getElementById('rsvpButton');
      const message = document.getElementById('rsvpMessage');

      function redirectToRSVP() {
        const name = input.value.trim().toLowerCase();
        if (!name) {
          message.textContent = 'Please enter your name.';
          message.classList.add('error');
          return;
        }

        const partyKey = guestMap[name];
        if (partyKey && partyMap[partyKey]) {
          window.location.href = partyMap[partyKey];
        } else {
          message.textContent = 'Sorry, we could not find your name. Please check your spelling or contact us.';
          message.classList.add('error');
        }
      }

      button.addEventListener('click', redirectToRSVP);
      input.addEventListener('keypress', (e) => { if (e.key === 'Enter') redirectToRSVP(); });
    });
  </script>
</section>
