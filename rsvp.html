<!-- RSVP Section -->
<section id="rsvp">
  <h2>RSVP</h2>
  <p>We canâ€™t wait to celebrate with you! Enter your name below to RSVP for your party:</p>

  <div style="margin: 2rem auto; max-width: 400px; text-align: left;">
    <input 
      type="text" 
      id="guestNameInput" 
      placeholder="Your Full Name" 
      style="
        width: 100%; 
        padding: 0.8rem 1rem; 
        font-family: 'Montserrat', sans-serif; 
        font-size: 1rem; 
        border: 1px solid var(--silver); 
        border-radius: 6px;
        margin-bottom: 1rem;
      "
    />
    <button 
      id="rsvpButton" 
      style="
        width: 100%; 
        padding: 0.8rem 1rem; 
        font-family: 'Montserrat', sans-serif; 
        font-size: 1rem; 
        color: white; 
        background-color: var(--green); 
        border: none; 
        border-radius: 6px; 
        cursor: pointer;
        transition: background-color 0.3s;
      "
      onmouseover="this.style.backgroundColor='#3b5c3d'"
      onmouseout="this.style.backgroundColor='var(--green)'"
    >
      RSVP
    </button>
  </div>
</section>

<script>
async function loadGuestList() {
  try {
    const response = await fetch('data/guestlist.csv');
    const csvText = await response.text();
    const lines = csvText.trim().split('\n');

    const nameToParty = {};
    const partyRSVPLinks = {};

    lines.slice(1).forEach(line => {
      const [guestName, partyKey, formURL] = line.split(',');
      if (!guestName) return;
      const cleanName = guestName.trim().toLowerCase();
      const cleanParty = partyKey.trim();
      const cleanURL = formURL.trim();

      nameToParty[cleanName] = cleanParty;
      partyRSVPLinks[cleanParty] = cleanURL;
    });

    return { nameToParty, partyRSVPLinks };
  } catch (err) {
    console.error('Error loading guest list:', err);
    alert('Sorry, we could not load the guest list. Please try again later.');
  }
}

document.getElementById('rsvpButton').addEventListener('click', async () => {
  const inputName = document.getElementById('guestNameInput').value.trim().toLowerCase();
  if (!inputName) return alert('Please enter your full name.');

  const { nameToParty, partyRSVPLinks } = await loadGuestList();
  const partyKey = nameToParty[inputName];

  if (partyKey && partyRSVPLinks[partyKey]) {
    window.location.href = partyRSVPLinks[partyKey];
  } else {
    alert('Name not found. Please check your spelling or contact us.');
  }
});
</script>
