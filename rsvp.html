<section id="rsvp">
  <h2>RSVP</h2>
  <p>We canâ€™t wait to celebrate with you! Please enter your name below to RSVP for your party.</p>

  <div class="rsvp-container">
    <input type="text" id="guestNameInput" placeholder="Enter your name" />
    <button id="rsvpButton">RSVP</button>
    <p id="rsvpMessage"></p>
  </div>

  <style>
    /* RSVP Section Styling */
    .rsvp-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
      max-width: 400px;
      margin: 2rem auto;
    }

    .rsvp-container input {
      width: 100%;
      padding: 0.8rem 1rem;
      font-family: 'Montserrat', sans-serif;
      font-size: 1rem;
      border: 2px solid var(--mulberry);
      border-radius: 8px;
      outline: none;
      transition: border-color 0.3s;
    }

    .rsvp-container input:focus {
      border-color: var(--green);
    }

    .rsvp-container button {
      padding: 0.8rem 1.2rem;
      font-family: 'Cormorant Garamond', serif;
      font-size: 1rem;
      color: white;
      background-color: var(--mulberry);
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .rsvp-container button:hover {
      background-color: var(--green);
    }

    #rsvpMessage {
      font-family: 'Montserrat', sans-serif;
      font-size: 0.95rem;
      color: var(--mulberry);
    }

    #rsvpMessage.error {
      color: red;
    }
  </style>

  <script>
    async function loadGuestList() {
      try {
        const response = await fetch('data/guestlist.csv');
        const text = await response.text();
        const rows = text.trim().split('\n');

        const guestMap = {}; // Maps guest name (lowercase) => form URL
        for (let i = 1; i < rows.length; i++) { // skip header
          const cols = rows[i].split(',').map(c => c.trim());
          if (cols.length < 3) continue;
          const guestName = cols[1].toLowerCase();
          const formUrl = cols[2];
          guestMap[guestName] = formUrl;
        }

        console.log('Guest list loaded:', Object.keys(guestMap)); // Debugging
        return guestMap;
      } catch (err) {
        console.error('Error loading guest list:', err);
        return {};
      }
    }

    document.addEventListener('DOMContentLoaded', async () => {
      const guestMap = await loadGuestList();
      const input = document.getElementById('guestNameInput');
      const button = document.getElementById('rsvpButton');
      const message = document.getElementById('rsvpMessage');

      button.addEventListener('click', () => {
        const name = input.value.trim().toLowerCase();
        if (!name) {
          message.textContent = 'Please enter your name.';
          message.classList.add('error');
          return;
        }

        // Search guestMap for partial match (allow any party member)
        const foundEntry = Object.keys(guestMap).find(guestName => guestName === name);
        if (foundEntry) {
          window.location.href = guestMap[foundEntry];
        } else {
          message.textContent = 'Sorry, we could not find your name. Please check your spelling or contact us.';
          message.classList.add('error');
        }
      });

      // Allow Enter key to submit
      input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') button.click();
      });
    });
  </script>
</section>
